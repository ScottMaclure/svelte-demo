<h1>Hello {{name}}</h1>
<p>Count: {{count}} <button on:click='doInc(count)'>Increment</button> <button on:click='set({ count: 0 })'>Reset</button></p>

<!-- TODO search/filter sub-component -->

<!-- TODO sub-component -->
<table border="1" width="100%">
  <thead>
    <th>Id</th>
    <th>First Name</th>
    <th>Last Name</th>
    <th>Email</th>
    <th>Actions</th>
  </thead>
  <tbody>
    {{#if items && items.length > 0}}
      {{#each items as item}}
          <tr>
            <td>{{item.id}}</td>
            <td>{{item.firstName}}</td>
            <td>{{item.lastName}}</td>
            <td>{{item.email}}</td>
            <td><button on:click='deleteItem(item.id)'>Delete</button></td>
          </tr>
      {{/each}}
    {{else}}
      <tr>
        <td colspan="5">
          {{#if isLoading}}
            <span class="loading">Loading...</span>
          {{else}}
            No rows present.
            <button on:click='requestData()'>Load</button>
          {{/if}}
        </td>
      </tr>
    {{/if}}
  </tbody>
</table>

<script>
  export default {
    data () {
      return {
        isLoading: false,
        count: 0,
        items: []
      }
    },
    methods: {
        doInc: function (count) {
            // TODO emit semantic event and get index.html to update localStorage, so the component knows nothing!
            window.localStorage.count = parseInt(count, 10) + 1
            this.set({ count: window.localStorage.count })
        },
        deleteItem: function (id) {
            console.log('Deleting id=%d.', id)
            let items = this.get('items').filter(function (item) {
              return item.id !== id
            })
            this.set({ items:  items })
            console.log('Done.')
        },
        requestData: function () {
          this.set({ isLoading: true })
          this.fire('requestData')
        },
        setData: function (data) {
          data.isLoading = false
          this.set(data)
        }
    }
  }
</script>